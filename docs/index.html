<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subspecies Mapper</title>
    <style>
        /* Set sans-serif font for the entire page */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #333;
        }

        .dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-top: 10px;
        }
        
        .dropdown input {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            transition: border-color 0.3s ease;
        }

        .dropdown input:focus {
            border-color: #007bff;
            outline: none;
        }

        .dropdown-menu {
            position: absolute;
            left: 0;
            top: 100%;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }
        
        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu div {
            padding: 10px;
            cursor: pointer;
            font-size: 1rem;
            border-bottom: 1px solid #eee;
        }

        .dropdown-menu div:hover {
            background-color: #f0f0f0;
        }

        .scientific-name {
            font-style: italic;
            color: #666;
        }

        .option-item {
            display: flex;
            justify-content: space-between;
        }

        .resolutions {
            margin-top: 20px;
        }

        .resolutions label {
            display: inline-block;
            margin-right: 20px;
            font-size: 1.1rem;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .resolutions label:hover,
        .resolutions input:checked + label {
            background-color: #007bff;
            color: white;
        }

        .resolutions input {
            display: none;
        }

        iframe {
            width: 100%;
            height: 70vh;
            margin-top: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Subspecies Mapper</h1>
        <div><b>Species:</b></div>
        <div class="dropdown">
            <input type="text" id="speciesInput" placeholder="Start typing..." oninput="filterDropdown()" autocomplete="off">
            <div id="dropdownMenu" class="dropdown-menu"></div>
        </div>

        <div class="resolutions">
            <div><b>Resolution:</b></div>
            <input type="radio" name="resolution" value="2" id="lowResolution" onchange="updateResolution()">
            <label for="lowResolution">Low</label>

            <input type="radio" name="resolution" value="3" id="mediumResolution" checked="checked" onchange="updateResolution()">
            <label for="mediumResolution">Medium</label>

            <input type="radio" name="resolution" value="4" id="highResolution" onchange="updateResolution()">
            <label for="highResolution">High</label>

            <input type="radio" name="resolution" value="5" id="ultraResolution" onchange="updateResolution()">
            <label for="ultraResolution">Ultra</label>
        </div>

        <iframe id="mapFrame" src="" frameborder="0"></iframe>
    </div>

    <script>
        let speciesData = [];
        let selectedSpecies = null;
        let selectedResolution = null;

        async function loadSpeciesData() {
            const response = await fetch('data/map_data.csv');
            const csvText = await response.text();
            speciesData = parseCSV(csvText);
            populateDropdown();
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                return headers.reduce((obj, header, i) => {
                    obj[header.trim()] = values[i].trim();
                    return obj;
                }, {});
            });
        }

        function populateDropdown() {
            const dropdownMenu = document.getElementById('dropdownMenu');
            dropdownMenu.innerHTML = '';
            const uniqueSpecies = [...new Set(speciesData.map(({ common_name }) => common_name))];

            uniqueSpecies.forEach(commonName => {
                const species = speciesData.find(s => s.common_name === commonName);
                const option = document.createElement('div');
                option.classList.add('option-item');
                option.innerHTML = `
                    <span>${species.common_name}</span>
                    <span class="scientific-name">(${removeHyphens(species.scientific_name)})</span>
                `;
                option.dataset.value = species.common_name;
                option.dataset.scientificName = species.scientific_name;
                option.onclick = () => selectSpecies(commonName);
                dropdownMenu.appendChild(option);
            });
        }

        // Function to remove hyphens from the scientific names
        function removeHyphens(scientificName) {
            return scientificName.replace(/-/g, ' ');
        }

        function filterDropdown() {
            const query = document.getElementById('speciesInput').value.toLowerCase();
            const dropdownMenu = document.getElementById('dropdownMenu');
            const options = dropdownMenu.children;

            let hasVisibleOptions = false;
            for (const option of options) {
                const species = option.dataset.value.toLowerCase();
                const scientificName = option.dataset.scientificName.toLowerCase();
                if (species.includes(query) || scientificName.includes(query)) {
                    option.style.display = 'block';
                    hasVisibleOptions = true;
                } else {
                    option.style.display = 'none';
                }
            }

            dropdownMenu.classList.toggle('show', hasVisibleOptions);
        }

        function selectSpecies(commonName) {
            selectedSpecies = commonName;
            const species = speciesData.find(s => s.common_name === commonName);
            const speciesScientificName = removeHyphens(species.scientific_name);
            document.getElementById('speciesInput').value = `${commonName} (${speciesScientificName})`;
            document.getElementById('dropdownMenu').classList.remove('show');
            updateMap();
        }

        function updateResolution() {
            const resolutionRadios = document.querySelectorAll('input[name="resolution"]');
            selectedResolution = Array.from(resolutionRadios).find(radio => radio.checked).value;
            updateMap();
        }

        function updateMap() {
            if (!selectedSpecies || !selectedResolution) return;
            const mapData = speciesData.find(
                s => s.common_name === selectedSpecies && s.resolution === selectedResolution
            );
            const iframe = document.getElementById('mapFrame');
            iframe.src = mapData ? mapData.map_url : '';
        }

        async function initializePage() {
            await loadSpeciesData();
            selectedSpecies = "Red-tailed Hawk";
            selectedResolution = "3";
            const species = speciesData.find(s => s.common_name === selectedSpecies);
            document.getElementById('speciesInput').value = `${selectedSpecies} (${removeHyphens(species.scientific_name)})`;
            document.querySelector('input[name="resolution"][value="3"]').checked = true;
            updateMap();
        };

        initializePage();
    </script>
</body>
</html>
